<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MorsEmulatores</title>
  <style>
    body {
      margin: 0;
      background: #0a0f18;
      color: #fff;
      font-family: "Segoe UI", sans-serif;
    }

    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(0, 20, 40, 0.9);
      backdrop-filter: blur(8px);
      padding: 10px 16px;
      z-index: 1000;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    #search {
      flex: 1;
      margin-right: 10px;
      padding: 8px 12px;
      border-radius: 8px;
      border: none;
      background: rgba(255,255,255,0.08);
      color: #fff;
      font-size: 15px;
    }

    #platformFilter {
      display: flex;
      gap: 6px;
    }

    .filter-btn {
      background: rgba(255,255,255,0.1);
      border: none;
      color: #9fc5ff;
      padding: 8px 10px;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s;
    }

    .filter-btn.active, .filter-btn:hover {
      background: #0052cc;
      color: #fff;
    }

    main {
      padding: 90px 20px 40px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 18px;
    }

    .card {
      background: #111a2b;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 0 8px rgba(0,0,0,0.4);
      transition: transform 0.25s;
    }

    .card:hover {
      transform: scale(1.05);
    }

    .card img {
      width: 100%;
      height: 100px;
      object-fit: contain;
      background: #000;
      padding: 6px;
    }

    .info {
      padding: 8px 10px;
    }

    .title {
      font-size: 14px;
      font-weight: 600;
      color: #cde1ff;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .platform {
      font-size: 12px;
      color: #7da8d7;
    }

    #backTop {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #0052cc;
      border: none;
      color: #fff;
      padding: 10px 14px;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
      transition: 0.3s;
      z-index: 999;
    }

    #backTop:hover {
      transform: scale(1.1);
      background: #007bff;
    }
  </style>
</head>
<body>
<header>
  <input id="search" type="text" placeholder="Cerca un gioco..." />
  <div id="platformFilter">
    <button class="filter-btn active" data-system="all">Tutti</button>
    <button class="filter-btn" data-system="gb">GB</button>
    <button class="filter-btn" data-system="gbc">GBC</button>
    <button class="filter-btn" data-system="gba">GBA</button>
  </div>
</header>

<main id="gameList"></main>
<button id="backTop">â†‘</button>

<script>
const list = document.getElementById("gameList");
const search = document.getElementById("search");
const backTop = document.getElementById("backTop");

const logos = {
  gba: "https://upload.wikimedia.org/wikipedia/commons/5/50/Game_Boy_Advance_logo.svg",
  gb:  "https://upload.wikimedia.org/wikipedia/commons/f/f2/Nintendo_Game_Boy_Logo.svg",
  gbc: "https://upload.wikimedia.org/wikipedia/commons/c/c5/Game_Boy_Color_logo.svg"
};

const sources = [
  "https://raw.githubusercontent.com/Neurone01/MorsEmulatores/refs/heads/main/games.json",
  "https://cdn.jsdelivr.net/gh/AlexBlackmore/roms@master/gb/?meta",
  "https://cdn.jsdelivr.net/gh/AlexBlackmore/roms@master/gbc/?meta",
  "https://cdn.jsdelivr.net/gh/AlexBlackmore/roms@master/gba/?meta"
];

let allGames = [];
let currentFilter = "all";

async function loadSource(url) {
  try {
    const res = await fetch(url);
    if (!res.ok) throw new Error(res.status);
    const data = await res.json();

    if (Array.isArray(data)) {
      // games.json locale
      return data.map(g => ({
        name: g.name,
        url: g.url,
        platform: g.platform.toLowerCase(),
        image: logos[g.platform.toLowerCase()] || ""
      }));
    }

    if (Array.isArray(data.files)) {
      // jsDelivr ?meta
      const sys = url.includes("/gba") ? "gba" : url.includes("/gbc") ? "gbc" : "gb";
      return data.files
        .filter(f => /\.(gba|gbc|gb|zip)$/i.test(f.name) && /Europe|EUR/i.test(f.name))
        .map(f => ({
          name: f.name.replace(/\.(gba|gbc|gb|zip)$/i, ""),
          url: `https://cdn.jsdelivr.net/gh/AlexBlackmore/roms@master/${sys}/${f.name}`,
          platform: sys,
          image: logos[sys]
        }));
    }
  } catch (err) {
    console.warn("Errore sorgente", url, err);
    return [];
  }
  return [];
}

function renderGames(games) {
  list.innerHTML = "";
  if (!games.length) {
    list.innerHTML = "<p style='grid-column:1/-1;text-align:center;color:#7da8d7;'>Nessun gioco trovato.</p>";
    return;
  }

  for (const g of games) {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <img src="${g.image}" alt="${g.name}">
      <div class="info">
        <div class="title">${g.name}</div>
        <div class="platform">${g.platform.toUpperCase()}</div>
      </div>`;
    card.addEventListener("click", () => {
      window.location.href = `play.html?rom=${encodeURIComponent(g.url)}&title=${encodeURIComponent(g.name)}&system=${g.platform}`;
    });
    list.appendChild(card);
  }
}

function filterAndRender() {
  const q = search.value.toLowerCase();
  let filtered = allGames.filter(g =>
    g.name.toLowerCase().includes(q) &&
    (currentFilter === "all" || g.platform === currentFilter)
  );
  renderGames(filtered);
}

search.addEventListener("input", filterAndRender);

document.querySelectorAll(".filter-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    currentFilter = btn.dataset.system;
    filterAndRender();
  });
});

window.addEventListener("scroll", () => {
  backTop.style.display = window.scrollY > 300 ? "block" : "none";
});
backTop.addEventListener("click", () => window.scrollTo({ top: 0, behavior: "smooth" }));

(async function init() {
  for (const src of sources) {
    const games = await loadSource(src);
    allGames.push(...games);
  }
  // rimuovi duplicati
  const seen = new Set();
  allGames = allGames.filter(g => {
    const key = g.name + g.platform;
    if (seen.has(key)) return false;
    seen.add(key);
    return true;
  });
  filterAndRender();
})();
</script>
</body>
</html>
