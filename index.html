<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>MorsEmulatores — Libreria</title>
  <style>
    :root {
      --bg:#05060a;
      --card:#0f1116;
      --muted:#9fb0c0;
      --accent:#00aaff;
      --accent-2:#00ffd1;
      --gap:14px;
      --radius:12px;
      --shadow:0 6px 18px rgba(0,0,0,0.6);
    }

    html,body {
      height:100%;
      margin:0;
      font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
      background:linear-gradient(180deg,#04050a 0%, #071025 100%);
      color:#e6f0f6;
    }

    .wrap {
      max-width:1300px;
      margin:0 auto;
      padding:18px;
    }

    header {
      position:sticky;
      top:0;
      z-index:20;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      padding:10px 14px;
      border-radius:12px;
      background:linear-gradient(180deg,rgba(5,6,10,0.85),rgba(5,6,10,0.6));
      backdrop-filter:blur(8px);
      box-shadow:var(--shadow);
    }

    .brand {
      display:flex;
      gap:10px;
      align-items:center;
    }

    .brand h1 { margin:0; font-size:18px; }
    .brand p { margin:0; color:var(--muted); font-size:12px; }

    .searchbar {
      flex:1;
      position:relative;
    }

    .searchbar input {
      width:100%;
      padding:12px 14px;
      border-radius:12px;
      border:0;
      background:rgba(255,255,255,0.05);
      color:inherit;
      outline:none;
      font-size:15px;
      box-shadow:var(--shadow);
    }

    main {
      display:grid;
      gap:var(--gap);
      grid-template-columns:repeat(auto-fill,minmax(230px,1fr));
      margin-top:14px;
    }

    .card {
      background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);
      border-radius:var(--radius);
      padding:12px;
      display:flex;
      flex-direction:column;
      box-shadow:var(--shadow);
      transition:transform .18s ease;
    }

    .card:hover { transform:translateY(-5px); }

    .thumb {
      height:100px;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius:10px;
      background:rgba(255,255,255,0.04);
      overflow:hidden;
      margin-bottom:10px;
    }

    .thumb img {
      max-width:100%;
      max-height:100%;
      object-fit:contain;
      filter:drop-shadow(0 6px 18px rgba(0,0,0,0.6));
    }

    .title { font-size:15px; font-weight:700; margin-bottom:8px; }

    .badge {
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(0,0,0,0.25);
      color:var(--accent);
      border:1px solid rgba(0,170,255,0.1);
      font-weight:700;
    }

    .btn {
      display:inline-block;
      background:linear-gradient(90deg,var(--accent),#007bbd);
      color:#02121a;
      padding:10px 14px;
      border-radius:10px;
      font-weight:700;
      text-decoration:none;
      margin-top:auto;
      text-align:center;
    }

    footer { text-align:center; color:var(--muted); margin-top:20px; }
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div style="width:44px;height:44px;border-radius:9px;background:linear-gradient(90deg,#001b2b,#003d52);display:flex;align-items:center;justify-content:center;font-weight:800;color:var(--accent);">
        EM
      </div>
      <div>
        <h1>MorsEmulatores</h1>
        <p>GBA / GBC / GB — Libreria giochi</p>
      </div>
    </div>

    <div class="searchbar">
      <input id="searchInput" placeholder="Cerca titolo o piattaforma..." aria-label="Cerca giochi">
    </div>

    <div>
      <button id="filterPlatform" style="background:rgba(255,255,255,0.08);border:0;padding:10px 12px;border-radius:8px;color:#9fb0c0;cursor:pointer;">
        Tutti
      </button>
    </div>
  </header>

  <main id="gameGrid"></main>

  <footer id="footer">Caricamento giochi…</footer>
</div>

<script>
"use strict";

/* --- CONFIG --- */
const config = {
  gamesJsonUrl: "https://raw.githubusercontent.com/Neurone01/MorsEmulatores/refs/heads/main/games.json",
  githubRepos: [
    { user: "AlexBlackmore", repo: "roms", branch: "master", folders: ["gba","gbc","gb"] }
  ],
  acceptExtensions: [".gba",".gb",".gbc",".zip"],
  logos: {
    gba: "https://upload.wikimedia.org/wikipedia/commons/5/50/Game_Boy_Advance_logo.svg",
    gb:  "https://upload.wikimedia.org/wikipedia/commons/f/f2/Nintendo_Game_Boy_Logo.svg",
    gbc: "https://upload.wikimedia.org/wikipedia/commons/c/c5/Game_Boy_Color_logo.svg"
  }
};

/* BIOS links */
const biosLinks = {
  gba: ["https://cdn.jsdelivr.net/gh/Neurone01/MorsEmulatores@main/Bios/gba_bios.bin"],
  gbc: ["https://cdn.jsdelivr.net/gh/Neurone01/MorsEmulatores@main/Bios/gbc_bios.bin"],
  gb: [
    "https://cdn.jsdelivr.net/gh/Neurone01/MorsEmulatores@main/Bios/gb_bios.bin",
    "https://cdn.jsdelivr.net/gh/Neurone01/MorsEmulatores@main/Bios/dmg0_rom.bin"
  ]
};

/* --- DOM --- */
const DOM = {
  grid: document.getElementById("gameGrid"),
  footer: document.getElementById("footer"),
  search: document.getElementById("searchInput"),
  filter: document.getElementById("filterPlatform")
};

let allGames = [];
let currentPlatform = "all";

/* --- FUNZIONI UTILI --- */
function slugify(s){return (s||"").toLowerCase().replace(/[^a-z0-9]+/g,"_");}
function detectSystemFromPath(path){
  const p = path.toLowerCase();
  if(p.includes("/gba/") || p.endsWith(".gba")) return "gba";
  if(p.includes("/gbc/") || p.endsWith(".gbc")) return "gbc";
  if(p.includes("/gb/")  || p.endsWith(".gb"))  return "gb";
  return "gba";
}

/* --- FETCH --- */
async function fetchGithubTree(user, repo, branch){
  const apiUrl = `https://api.github.com/repos/${user}/${repo}/git/trees/${branch}?recursive=1`;
  const r = await fetch(apiUrl);
  const json = await r.json();
  return json.tree || [];
}

async function loadAllGames(){
  const all = [];
  for(const info of config.githubRepos){
    const tree = await fetchGithubTree(info.user, info.repo, info.branch);
    for(const item of tree){
      if(item.type !== "blob") continue;
      if(!config.acceptExtensions.some(ext=>item.path.endsWith(ext))) continue;
      const sys = detectSystemFromPath(item.path);
      const title = item.path.split("/").pop().replace(/\.(gba|gbc|gb|zip)$/i,"").replace(/_/g," ");
      all.push({
        id: slugify(title+"_"+sys),
        title,
        system: sys,
        url: `https://cdn.jsdelivr.net/gh/${info.user}/${info.repo}@${info.branch}/${item.path}`
      });
    }
  }
  allGames = all.sort((a,b)=>a.title.localeCompare(b.title));
  DOM.footer.textContent = `${allGames.length} giochi trovati`;
  renderList(allGames);
}

/* --- RENDER --- */
function getPlayURL(game){
  const sys = game.system.toLowerCase();
  const bios = biosLinks[sys] ? biosLinks[sys].join(",") : "";
  return `play.html?rom=${encodeURIComponent(game.url)}&title=${encodeURIComponent(game.title)}&system=${sys}&bios=${encodeURIComponent(bios)}`;
}

function renderList(list){
  DOM.grid.innerHTML = list.map(g=>`
    <article class="card">
      <div class="thumb"><img src="${config.logos[g.system]}" alt=""></div>
      <div class="title">${g.title}</div>
      <div class="badge">${g.system.toUpperCase()}</div>
      <a href="${getPlayURL(g)}" class="btn">▶ Gioca</a>
    </article>
  `).join("");
}

/* --- FILTRO --- */
function applyFilters(){
  const q = DOM.search.value.trim().toLowerCase();
  let list = allGames.slice();
  if(currentPlatform !== "all"){
    list = list.filter(g => g.system === currentPlatform);
  }
  if(q) list = list.filter(g => g.title.toLowerCase().includes(q));
  renderList(list);
  DOM.footer.textContent = `${list.length} / ${allGames.length} giochi`;
}

/* --- EVENTI --- */
DOM.search.addEventListener("input", applyFilters);
DOM.filter.addEventListener("click", () => {
  const next = currentPlatform === "all" ? "gba" : currentPlatform === "gba" ? "gbc" : currentPlatform === "gbc" ? "gb" : "all";
  currentPlatform = next;
  DOM.filter.textContent = (next === "all") ? "Tutti" : next.toUpperCase();
  applyFilters();
});

/* --- INIT --- */
loadAllGames();
</script>
</body>
</html>
