<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>MorsEmulatores</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(180deg, #0b0c10, #0d1117);
      color: #d1e0f0;
      overflow-x: hidden;
    }

    header {
      position: fixed;
      top: 0;
      width: 100%;
      background: rgba(10, 10, 15, 0.85);
      backdrop-filter: blur(10px);
      padding: 10px 0;
      text-align: center;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0,0,0,0.6);
    }

    h1 {
      margin: 6px 0;
      font-size: 22px;
      color: #58a6ff;
      letter-spacing: 1px;
    }

    #search {
      width: 60%;
      max-width: 400px;
      padding: 10px;
      border-radius: 8px;
      border: none;
      background: rgba(255,255,255,0.08);
      color: #fff;
      font-size: 14px;
    }

    #filterPlatform {
      background: rgba(255,255,255,0.08);
      border: 0;
      padding: 10px 12px;
      border-radius: 8px;
      color: #9fb0c0;
      cursor: pointer;
      margin-top: 10px;
      font-size: 14px;
    }

    main {
      margin-top: 140px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 20px;
      padding: 20px;
    }

    .game {
      background: rgba(255,255,255,0.05);
      border-radius: 15px;
      overflow: hidden;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }

    .game:hover {
      transform: translateY(-5px);
      box-shadow: 0 0 18px rgba(0,0,0,0.7);
    }

    .game img {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }

    .game h2 {
      font-size: 15px;
      text-align: center;
      color: #dce6f0;
      padding: 10px;
      margin: 0;
      height: 60px;
    }

    .play-btn {
      display: block;
      text-align: center;
      background: #238636;
      color: #fff;
      padding: 10px;
      font-weight: bold;
      text-decoration: none;
      border-radius: 0 0 15px 15px;
    }

    .play-btn:hover {
      background: #2ea043;
    }

    #backToTop {
      position: fixed;
      bottom: 25px;
      right: 25px;
      background: rgba(30, 30, 30, 0.85);
      color: #00aaff;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      text-align: center;
      line-height: 40px;
      cursor: pointer;
      display: none;
      font-size: 22px;
      z-index: 1000;
      transition: all 0.3s ease;
    }

    #backToTop:hover {
      background: rgba(50,50,50,0.9);
      transform: scale(1.1);
    }
  </style>
</head>
<body>
  <header>
    <h1>MorsEmulatores</h1>
    <input type="text" id="search" placeholder="ðŸ” Cerca un gioco...">
    <br>
    <button id="filterPlatform">GBA</button>
  </header>

  <main id="gamesContainer">Caricamento...</main>

  <div id="backToTop">â†‘</div>

  <script>
    const container = document.getElementById('gamesContainer');
    const search = document.getElementById('search');
    const filterBtn = document.getElementById('filterPlatform');
    const backToTop = document.getElementById('backToTop');

    const biosLinks = {
      gba: "https://cdn.jsdelivr.net/gh/Neurone01/MorsEmulatores@main/Bios/gba_bios.bin",
      gbc: "https://cdn.jsdelivr.net/gh/Neurone01/MorsEmulatores@main/Bios/gbc_bios.bin",
      gb: "https://cdn.jsdelivr.net/gh/Neurone01/MorsEmulatores@main/Bios/gb_bios.bin,https://cdn.jsdelivr.net/gh/Neurone01/MorsEmulatores@main/Bios/dmg0_rom.bin"
    };

    const repoBase = "https://cdn.jsdelivr.net/gh/AlexBlackmore/roms@master";
    let currentPlatform = "gba";
    let gamesList = [];

    async function loadGames() {
      container.textContent = "Caricamento giochi " + currentPlatform.toUpperCase() + "...";
      try {
        const res = await fetch(`${repoBase}/${currentPlatform}/`);
        const text = await res.text();
        const files = [...text.matchAll(/href="([^"]+\.(gba|gbc|gb))"/g)].map(x => x[1]);

        gamesList = files.map(name => ({
          name: decodeURIComponent(name.replace(/\.(gba|gbc|gb)$/, '')),
          url: `${repoBase}/${currentPlatform}/${name}`
        }));

        renderGames();
      } catch (err) {
        container.textContent = "Errore nel caricamento.";
        console.error(err);
      }
    }

    function renderGames() {
      const q = search.value.toLowerCase();
      const filtered = gamesList.filter(g => g.name.toLowerCase().includes(q));

      container.innerHTML = filtered.map(g => `
        <div class="game">
          <img src="https://placehold.co/300x150/111/FFF?text=${encodeURIComponent(g.name.slice(0,20))}" alt="">
          <h2>${g.name}</h2>
          <a class="play-btn" href="play.html?rom=${encodeURIComponent(g.url)}&title=${encodeURIComponent(g.name)}&bios=${encodeURIComponent(biosLinks[currentPlatform])}">
            â–¶ Gioca
          </a>
        </div>
      `).join('') || "<p>Nessun gioco trovato.</p>";
    }

    // Filtraggio per piattaforma
    filterBtn.addEventListener('click', () => {
      if (currentPlatform === "gba") currentPlatform = "gbc";
      else if (currentPlatform === "gbc") currentPlatform = "gb";
      else currentPlatform = "gba";
      filterBtn.textContent = currentPlatform.toUpperCase();
      loadGames();
    });

    search.addEventListener('input', renderGames);

    // Pulsante torna su
    window.addEventListener('scroll', () => {
      backToTop.style.display = window.scrollY > 300 ? 'block' : 'none';
    });
    backToTop.addEventListener('click', () => window.scrollTo({top:0, behavior:'smooth'}));

    loadGames();
  </script>
</body>
</html>
