<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>MorsEmulatores</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(180deg, #0b0c10, #0d1117);
      color: #d1e0f0;
      overflow-x: hidden;
    }

    header {
      position: fixed;
      top: 0;
      width: 100%;
      background: rgba(10, 10, 15, 0.85);
      backdrop-filter: blur(10px);
      padding: 10px 0;
      text-align: center;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0,0,0,0.6);
    }

    h1 {
      margin: 6px 0;
      font-size: 22px;
      color: #58a6ff;
    }

    #search {
      width: 60%;
      max-width: 400px;
      padding: 10px;
      border-radius: 8px;
      border: none;
      background: rgba(255,255,255,0.08);
      color: #fff;
      font-size: 14px;
    }

    #filterPlatform {
      background: rgba(255,255,255,0.08);
      border: 0;
      padding: 10px 12px;
      border-radius: 8px;
      color: #9fb0c0;
      cursor: pointer;
      margin-top: 10px;
      font-size: 14px;
    }

    main {
      margin-top: 140px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 20px;
      padding: 20px;
    }

    .game {
      background: rgba(255,255,255,0.05);
      border-radius: 15px;
      overflow: hidden;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }

    .game:hover {
      transform: translateY(-5px);
      box-shadow: 0 0 18px rgba(0,0,0,0.7);
    }

    .game img {
      width: 100%;
      height: 150px;
      object-fit: contain;
      background: #000;
    }

    .game h2 {
      font-size: 15px;
      text-align: center;
      color: #dce6f0;
      padding: 10px;
      margin: 0;
      height: 60px;
    }

    .play-btn {
      display: block;
      text-align: center;
      background: #238636;
      color: #fff;
      padding: 10px;
      font-weight: bold;
      text-decoration: none;
      border-radius: 0 0 15px 15px;
    }

    .play-btn:hover {
      background: #2ea043;
    }

    #backToTop {
      position: fixed;
      bottom: 25px;
      right: 25px;
      background: rgba(30, 30, 30, 0.85);
      color: #00aaff;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      text-align: center;
      line-height: 40px;
      cursor: pointer;
      display: none;
      font-size: 22px;
      z-index: 1000;
      transition: all 0.3s ease;
    }

    #backToTop:hover {
      background: rgba(50,50,50,0.9);
      transform: scale(1.1);
    }

    /* ðŸ”¹ Loader animato */
    #loader {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #0b0c10;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      transition: opacity 0.8s ease, visibility 0.8s ease;
    }

    #loader.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .spinner {
      border: 6px solid rgba(255,255,255,0.1);
      border-top: 6px solid #58a6ff;
      border-radius: 50%;
      width: 70px;
      height: 70px;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    #loader p {
      color: #58a6ff;
      font-size: 16px;
      letter-spacing: 1px;
    }

  </style>
</head>
<body>
  <div id="loader">
    <div class="spinner"></div>
    <p>Caricamento giochi...</p>
  </div>

  <header>
    <h1>MorsEmulatores</h1>
    <input type="text" id="search" placeholder="ðŸ” Cerca un gioco...">
    <br>
    <button id="filterPlatform">Tutti</button>
  </header>

  <main id="gamesContainer">Caricamento...</main>
  <div id="backToTop">â†‘</div>

  <script>
    const container = document.getElementById('gamesContainer');
    const search = document.getElementById('search');
    const filterBtn = document.getElementById('filterPlatform');
    const backToTop = document.getElementById('backToTop');
    const loader = document.getElementById('loader');

    const biosLinks = {
      gba: "https://cdn.jsdelivr.net/gh/Neurone01/MorsEmulatores@main/Bios/gba_bios.bin",
      gbc: "https://cdn.jsdelivr.net/gh/Neurone01/MorsEmulatores@main/Bios/gbc_bios.bin",
      gb: "https://cdn.jsdelivr.net/gh/Neurone01/MorsEmulatores@main/Bios/gb_bios.bin,https://cdn.jsdelivr.net/gh/Neurone01/MorsEmulatores@main/Bios/dmg0_rom.bin"
    };

    const logos = {
      gba: "https://upload.wikimedia.org/wikipedia/commons/5/50/Game_Boy_Advance_logo.svg",
      gb: "https://upload.wikimedia.org/wikipedia/commons/f/f2/Nintendo_Game_Boy_Logo.svg",
      gbc: "https://upload.wikimedia.org/wikipedia/commons/c/c5/Game_Boy_Color_logo.svg"
    };

    let allGames = [];
    let currentFilter = "all";

    async function loadAllGames() {
      try {
        // Carica dal tuo games.json
        const jsonRes = await fetch("https://raw.githubusercontent.com/Neurone01/MorsEmulatores/main/games.json");
        const jsonGames = await jsonRes.json();

        // Simulazione di giochi GitHub
        const githubGames = [
          { name: "Ace Combat Advance (USA, Europe)", platform: "gba", url: "https://cdn.jsdelivr.net/gh/AlexBlackmore/roms@master/gba/Ace%20Combat%20Advance%20(USA%2C%20Europe).gba" },
          { name: "PokÃ©mon Red (Europe)", platform: "gb", url: "https://cdn.jsdelivr.net/gh/AlexBlackmore/roms@master/gb/Pokemon%20Red%20(Europe).gb" },
          { name: "Zelda Oracle of Seasons (Europe)", platform: "gbc", url: "https://cdn.jsdelivr.net/gh/AlexBlackmore/roms@master/gbc/Zelda%20Oracle%20of%20Seasons%20(Europe).gbc" }
        ];

        allGames = [...jsonGames, ...githubGames].map(g => ({
          id: g.id || g.name.toLowerCase().replace(/\s+/g, "_"),
          name: g.name,
          platform: g.platform || detectPlatform(g.url),
          image: logos[g.platform] || logos[detectPlatform(g.url)],
          url: g.url
        }));

        renderGames();
      } catch (err) {
        console.error(err);
        container.textContent = "Errore nel caricamento dei giochi.";
      } finally {
        loader.classList.add("hidden");
      }
    }

    function detectPlatform(url) {
      if (url.endsWith(".gba")) return "gba";
      if (url.endsWith(".gbc")) return "gbc";
      if (url.endsWith(".gb")) return "gb";
      return "gba";
    }

    function renderGames() {
      const q = search.value.toLowerCase();
      const filtered = allGames.filter(g =>
        (currentFilter === "all" || g.platform === currentFilter) &&
        g.name.toLowerCase().includes(q)
      );

      container.innerHTML = filtered.map(g => `
        <div class="game">
          <img src="${g.image}" alt="${g.platform}">
          <h2>${g.name}</h2>
          <a class="play-btn" href="play.html?rom=${encodeURIComponent(g.url)}&title=${encodeURIComponent(g.name)}&system=${g.platform}&bios=${encodeURIComponent(biosLinks[g.platform])}">
            â–¶ Gioca
          </a>
        </div>
      `).join('') || "<p>Nessun gioco trovato.</p>";
    }

    filterBtn.addEventListener('click', () => {
      if (currentFilter === "all") currentFilter = "gba";
      else if (currentFilter === "gba") currentFilter = "gbc";
      else if (currentFilter === "gbc") currentFilter = "gb";
      else currentFilter = "all";
      filterBtn.textContent = currentFilter === "all" ? "Tutti" : currentFilter.toUpperCase();
      renderGames();
    });

    search.addEventListener('input', renderGames);

    window.addEventListener('scroll', () => {
      backToTop.style.display = window.scrollY > 300 ? 'block' : 'none';
    });
    backToTop.addEventListener('click', () => window.scrollTo({top:0, behavior:'smooth'}));

    loadAllGames();
  </script>
</body>
</html>
